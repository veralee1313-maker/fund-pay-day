<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å¾©è¯å…±åŒåŸºé‡‘è²·å›æ·¨å€¼èˆ‡ä»˜æ¬¾æ—¥ç¨‹è©¦ç®—</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; color: #1e293b; }
    .card { border-radius: 1.5rem; box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1); }
    .btn-active:active { transform: scale(0.98); background-color: #0f172a; }
    .data-row { display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding: 14px 0; }
    .data-label { color: #64748b; font-size: 0.8rem; font-weight: 500; }
    .data-value { color: #334155; font-size: 0.85rem; font-weight: 700; text-align: right; }
    .sticky-warning { position: sticky; top: 0; z-index: 100; }
    .timeline-date { width: 100px; flex-shrink: 0; font-family: 'Courier New', Courier, monospace; }
    .holiday-badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 700; margin-bottom: 2px; }
    .holiday-tip { border-left: 4px solid #6366f1; }
  </style>
</head>
<body class="pb-20">

  <!-- é ‚éƒ¨è­¦ç¤ºæ¬„ -->
  <div class="sticky-warning bg-amber-50 border-b border-amber-200 p-4 text-center shadow-sm">
    <p class="text-amber-900 text-[11px] md:text-xs font-bold flex items-center justify-center gap-2 leading-relaxed text-balance">
      <span>âš ï¸</span> é‡è¦æé†’ï¼šæœ¬å·¥å…·ä¹‹è¨ˆç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›äº¤æ˜“ç”Ÿæ•ˆæ—¥ã€æ·¨å€¼æ—¥èˆ‡ä»˜æ¬¾æ—¥è«‹å‹™å¿…ä»¥æŠ•ä¿¡å…¬å¸å®˜æ–¹å…¬å‘ŠåŠéŠ€è¡Œæœ€çµ‚å…¥å¸³ç‚ºæº–ã€‚
    </p>
  </div>

  <div class="max-w-2xl mx-auto px-4 mt-8">
    <!-- Header -->
    <div class="bg-indigo-950 text-white p-8 rounded-t-3xl shadow-xl">
      <h1 class="text-2xl font-black flex items-center justify-center md:justify-start gap-3 tracking-tight">
        <span>ğŸ“Š</span> å…±åŒåŸºé‡‘è²·å›æ·¨å€¼èˆ‡ä»˜æ¬¾æ—¥ç¨‹è©¦ç®—
      </h1>
      <p class="text-indigo-300 text-xs mt-2 font-medium tracking-wide text-center md:text-left">115å¹´ (2026) å…¨çƒè·¨åœ‹å¸‚å ´ä¼‘å¸‚é€£å‹•ç³»çµ±</p>
    </div>

    <!-- Main Card -->
    <div class="bg-white p-6 md:p-8 rounded-b-3xl card border-t border-slate-50 shadow-2xl">
      <div id="errorBox" class="hidden mb-6 p-4 bg-red-50 text-red-700 text-sm rounded-xl border border-red-100 font-bold italic text-center"></div>

      <div class="space-y-6">
        <!-- 1. æœå°‹ -->
        <div>
          <label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">1. å¿«é€Ÿæœå°‹åŸºé‡‘åç¨±</label>
          <input type="text" id="fundSearch" placeholder="æœå°‹åç¨±ï¼Œå¦‚ï¼šé«˜æˆé•·ã€å¾©è¯å¾©è¯ã€å¥§æ—åŒ¹å…‹..." 
            oninput="hideResult(); updateSearchList();"
            class="w-full p-4 rounded-2xl outline-none bg-slate-50 border border-slate-200 focus:bg-white focus:ring-4 focus:ring-indigo-100 transition-all text-sm font-medium">
        </div>

        <!-- 2. é¸æ“‡ -->
        <div>
          <label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">2. é¸æ“‡å…±åŒåŸºé‡‘ (é¡¯ç¤º T+N)</label>
          <select id="fundSelect" onchange="hideResult();"
            class="w-full p-4 rounded-2xl bg-white border border-slate-200 outline-none focus:ring-4 focus:ring-indigo-100 transition-all text-sm font-bold">
            <!-- JS æ¸²æŸ“ -->
          </select>
        </div>

        <!-- 3. å§”è¨—æ—¥æœŸ -->
        <div>
          <label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">3. å§”è¨—è²·å›æ—¥æœŸ</label>
          
          <!-- å³æ™‚ç¯€æ—¥æç¤º -->
          <div id="dateNote" class="mb-3 p-4 bg-indigo-50/50 rounded-2xl text-[11px] text-slate-500 hidden border border-indigo-100 holiday-tip animate-in fade-in duration-300"></div>

          <input type="date" id="tradeDate" min="2026-01-01" max="2026-12-31" onchange="hideResult(); updateHolidayNote();"
            class="w-full p-4 rounded-2xl border border-slate-200 outline-none focus:ring-4 focus:ring-indigo-100 transition-all text-sm font-bold">
        </div>

        <button onclick="calculate()" class="w-full bg-indigo-950 hover:bg-black text-white font-black py-5 rounded-2xl shadow-xl transition-all btn-active flex items-center justify-center gap-2 text-lg uppercase tracking-widest">
          <span>ğŸ”</span> æŸ¥è©¢è©¦ç®—
        </button>
      </div>

      <!-- Result Area -->
      <div id="resultArea" class="hidden mt-10 border-t border-slate-100 pt-8 animate-in fade-in duration-500">
        
        <!-- Key Dates Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
          <div class="bg-slate-50 p-5 rounded-3xl border border-slate-100 shadow-sm text-center">
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">ç”Ÿæ•ˆäº¤æ˜“æ—¥ (T)</span>
            <div id="resEff" class="text-lg font-black text-slate-800 mt-1">---</div>
            <div id="resEffNote" class="text-[9px] text-slate-400 mt-1 italic font-medium"></div>
          </div>
          <div class="bg-indigo-50 p-5 rounded-3xl border border-indigo-100 shadow-sm text-center">
            <span class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">è²·å›æ·¨å€¼æ—¥</span>
            <div id="resNav" class="text-lg font-black text-indigo-900 mt-1">---</div>
            <div class="text-[9px] text-indigo-500 mt-1 font-bold italic underline">T+1æ—¥æ·¨å€¼</div>
          </div>
          <div class="bg-emerald-600 text-white p-5 rounded-3xl shadow-lg text-center">
            <span class="text-[10px] font-bold text-emerald-100 uppercase tracking-widest">è²·å›ä»˜æ¬¾æ—¥</span>
            <div id="resPay" class="text-xl font-black mt-1">---</div>
            <div id="resLagText" class="text-[9px] text-emerald-50 mt-1 font-medium tracking-tight">é€±æœŸï¼šT+---</div>
          </div>
        </div>

        <!-- Metadata Card -->
        <div class="bg-white rounded-3xl border border-slate-100 p-2 overflow-hidden shadow-sm mb-6">
          <div class="bg-slate-50 px-5 py-3 text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-100">
            ä¿ç®¡éŠ€è¡Œèˆ‡éŠ·å”®å°ˆæˆ¶è³‡è¨Š (çœŸåˆ‡æ ¸å°ç‰ˆ)
          </div>
          <div class="px-5">
            <div class="data-row">
              <span class="data-label">ä¿ç®¡æ©Ÿæ§‹</span>
              <span id="resBank" class="data-value text-indigo-900 font-bold">---</span>
            </div>
            <div class="data-row flex-col items-start gap-1">
              <span class="data-label">éŠ·å”®å°ˆæˆ¶ (è‡ªç„¶äºº)</span>
              <span id="resAccNatural" class="data-value text-left w-full text-indigo-700 text-[13px] font-mono whitespace-pre-line leading-relaxed tracking-tight">---</span>
            </div>
            <div class="data-row border-none flex-col items-start gap-1">
              <span class="data-label">éŠ·å”®å°ˆæˆ¶ (æ³•äºº)</span>
              <span id="resAccLegal" class="data-value text-left w-full text-indigo-700 text-[13px] font-mono whitespace-pre-line leading-relaxed tracking-tight">---</span>
            </div>
          </div>
        </div>

        <!-- Timeline Log -->
        <div class="bg-slate-50 p-5 rounded-3xl border border-slate-100 shadow-inner">
          <h3 class="text-xs font-bold text-slate-400 mb-4 flex items-center gap-2 uppercase tracking-widest px-1">
            <span>âŒ›</span> 115å¹´ (2026) è·¨åœ‹è¨ˆç®—è©³ç´°æ­·ç¨‹
          </h3>
          <div id="logList" class="space-y-0.5">
            <!-- JS æ¸²æŸ“ -->
          </div>
        </div>
      </div>
    </div>

    <div class="mt-8 text-center text-slate-400 text-[10px] leading-relaxed px-5">
      * å·²æ•´åˆå°è‚¡ 115 å¹´å…¬å‘Šï¼š1/1 å…ƒæ—¦ä¼‘ã€1/2 æ­£å¸¸äº¤æ˜“ã€2/12-2/13 å¸‚å ´ç„¡äº¤æ˜“ã€2/16-2/20 æ˜¥ç¯€å‡æœŸã€‚<br/>
      * æœ¬ç³»çµ±è¨ˆç®—è³‡æ–™çœŸåˆ‡æ ¸å° 46 æª”å…±åŒåŸºé‡‘æ‰‹å†Šèˆ‡å¤šåœ‹äº¤æ˜“æ‰€å®˜æ–¹å‡æ›†ã€‚
    </div>
  </div>

<script>
/**
 * 2026 å…¨çƒå¸‚å ´å‡æ—¥ (ç²¾ç¢ºæ ¡å°å®˜æ–¹è³‡æ–™)
 */
const HOLIDAYS_2026 = {
  "TW": {
    "2026-01-01": "å…ƒæ—¦ä¼‘å¸‚", 
    "2026-02-12": "è¾²æ›†å¹´å‰å¸‚å ´ç„¡äº¤æ˜“", "2026-02-13": "è¾²æ›†å¹´å‰å¸‚å ´ç„¡äº¤æ˜“", 
    "2026-02-16": "è¾²æ›†é™¤å¤•", "2026-02-17": "æ˜¥ç¯€åˆä¸€", "2026-02-18": "æ˜¥ç¯€åˆäºŒ", "2026-02-19": "æ˜¥ç¯€åˆä¸‰", "2026-02-20": "æ˜¥ç¯€è£œå‡",
    "2026-02-27": "å’Œå¹³ç´€å¿µæ—¥è£œå‡", "2026-04-02": "æ¸…æ˜ç¯€é€£å‡", "2026-04-03": "æ¸…æ˜ç¯€é€£å‡", "2026-05-01": "å‹å‹•ç¯€ä¼‘å¸‚", "2026-06-19": "ç«¯åˆç¯€", "2026-09-25": "ä¸­ç§‹ç¯€", "2026-10-09": "åœ‹æ…¶æ—¥è£œå‡"
  },
  "CN": {
    "2026-01-01": "å…ƒæ—¦", "2026-01-02": "å…ƒæ—¦èª¿ä¼‘", "2026-02-17": "æ˜¥ç¯€", "2026-02-18": "æ˜¥ç¯€", "2026-02-19": "æ˜¥ç¯€", "2026-02-20": "æ˜¥ç¯€", "2026-02-23": "æ˜¥ç¯€ä¼‘å¸‚èª¿æ•´", "2026-05-01": "äº”ä¸€å‹å‹•ç¯€", "2026-10-01": "åœ‹æ…¶ç¯€"
  },
  "US": {
    "2026-01-01": "å…ƒæ—¦", "2026-01-19": "é¦¬ä¸è·¯å¾·é‡‘ç´€å¿µæ—¥", "2026-02-16": "ç¸½çµ±æ—¥", "2026-04-03": "è€¶ç©Œå—é›£æ—¥", "2026-05-25": "é™£äº¡å°‡å£«æ—¥", "2026-06-19": "å…­æœˆç¯€", "2026-07-03": "ç¨ç«‹æ—¥è£œå‡",
    "2026-09-07": "å‹å‹•ç¯€", "2026-11-26": "æ„Ÿæ©ç¯€", "2026-12-25": "è–èª•ç¯€"
  },
  "USB": { "2026-10-12": "å“¥å€«å¸ƒæ—¥(å‚µå¸‚ä¼‘)", "2026-11-11": "é€€ä¼è»äººç¯€(å‚µå¸‚ä¼‘)" },
  "JP": {
    "2026-01-01": "å…ƒæ—¦", "2026-01-02": "æ–°å¹´å‡æœŸ", "2026-01-12": "æˆäººæ—¥", "2026-02-11": "å»ºåœ‹ç´€å¿µæ—¥", "2026-02-23": "å¤©çš‡èª•ç”Ÿæ—¥è£œå‡", "2026-05-05": "å…’ç«¥æ—¥"
  },
  "HK": { "2026-01-01": "å…ƒæ—¦", "2026-02-17": "è¾²æ›†æ–°å¹´", "2026-04-03": "è€¶ç©Œå—é›£æ—¥", "2026-10-01": "åœ‹æ…¶ç¯€" },
  "EU": { "2026-01-01": "å…ƒæ—¦", "2026-04-03": "è€¶ç©Œå—é›£æ—¥", "2026-04-06": "å¾©æ´»ç¯€é€±ä¸€", "2026-12-25": "è–èª•ç¯€" },
  "LU": { "2026-01-01": "å…ƒæ—¦", "2026-04-06": "å¾©æ´»ç¯€é€±ä¸€", "2026-05-14": "è€¶ç©Œå‡å¤©ç¯€", "2026-06-23": "åœ‹æ…¶æ—¥", "2026-12-25": "è–èª•ç¯€" }
};

/**
 * 46 æª”å…±åŒåŸºé‡‘å®Œæ•´æ¸…å–® (ä¿ç®¡éŠ€è¡Œåç¨±çœŸåˆ‡æ ¡å°)
 */
const fundData = [
  { id: "F01", name: "å¾©è¯å¾©è¯åŸºé‡‘", pay: 3, bank: "ç‰å±±éŠ€è¡Œ", accN: "95707 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "95707 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F02", name: "å¾©è¯è²¨å¹£å¸‚å ´åŸºé‡‘", pay: 1, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "347 + ID(å«è‹±æ–‡11ç¢¼)", accL: "347 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F03", name: "å¾©è¯é«˜æˆé•·åŸºé‡‘", pay: 3, bank: "æ°¸è±éŠ€è¡Œ", accN: "305 + ID(å«è‹±æ–‡11ç¢¼)", accL: "305 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F04", name: "å¾©è¯å‚³å®¶åŸºé‡‘", pay: 2, bank: "æ°¸è±éŠ€è¡Œ", accN: "791 + ID(å«è‹±æ–‡11ç¢¼)", accL: "791 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F05", name: "å¾©è¯æœ‰åˆ©è²¨å¹£å¸‚å ´åŸºé‡‘", pay: 1, bank: "æ°¸è±éŠ€è¡Œ", accN: "750 + ID(å«è‹±æ–‡11ç¢¼)", accL: "750 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F06", name: "å¾©è¯æ•¸ä½ç¶“æ¿ŸåŸºé‡‘", pay: 3, bank: "å…†è±éŠ€è¡Œ", accN: "33438 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "33438 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F07", name: "å¾©è¯å‚³å®¶äºŒè™ŸåŸºé‡‘", pay: 3, bank: "æ°¸è±éŠ€è¡Œ", accN: "793 + ID(å«è‹±æ–‡11ç¢¼)", accL: "793 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F08", name: "å¾©è¯ä¸­å°ç²¾é¸åŸºé‡‘", pay: 3, bank: "æ°¸è±éŠ€è¡Œ", accN: "794 + ID(å«è‹±æ–‡11ç¢¼)", accL: "794 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F09", name: "å¾©è¯å…¨çƒå‚µåˆ¸åŸºé‡‘", pay: 4, bank: "æ°¸è±éŠ€è¡Œ", accN: "799 + ID(å«è‹±æ–‡11ç¢¼)", accL: "799 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "USB", "TW"] },
  { id: "F10", name: "å¾©è¯äººç”Ÿç›®æ¨™åŸºé‡‘", pay: 3, bank: "æ°¸è±éŠ€è¡Œ", accN: "797 + ID(å«è‹±æ–‡11ç¢¼)", accL: "797 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F11", name: "å¾©è¯å…¨çƒå¹³è¡¡åŸºé‡‘", pay: 4, bank: "ç‰å±±éŠ€è¡Œ", accN: "95708 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "95708 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F12", name: "å¾©è¯ç¥ç›¾åŸºé‡‘", pay: 3, bank: "ä¸Šæµ·å•†æ¥­å„²è“„éŠ€è¡Œ", accN: "028 + ID(å«è‹±æ–‡11ç¢¼)", accL: "028 + 00 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼) + 0", mkts: ["TW"] },
  { id: "F13", name: "å¾©è¯å¥§æ—åŒ¹å…‹å…¨çƒçµ„åˆåŸºé‡‘", pay: 6, bank: "åˆä½œé‡‘åº«", accN: "99395 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "99395 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "LU", "TW"] },
  { id: "F14", name: "å¾©è¯å…¨æ–¹ä½åŸºé‡‘Aé¡å‹", pay: 3, bank: "ç‰å±±éŠ€è¡Œ", accN: "95709 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "95709 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F15", name: "å¾©è¯äºå¤ªå¹³è¡¡åŸºé‡‘", pay: 4, bank: "æ°¸è±éŠ€è¡Œ", accN: "535 + ID(å«è‹±æ–‡11ç¢¼)", accL: "535 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW", "HK"] },
  { id: "F16", name: "å¾©è¯å…¨çƒå‚µåˆ¸çµ„åˆåŸºé‡‘", pay: 6, bank: "ç‰å±±éŠ€è¡Œ", accN: "95220 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "95220 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "LU", "TW"] },
  { id: "F17", name: "å¾©è¯äºå¤ªæˆé•·åŸºé‡‘", pay: 4, bank: "æ°¸è±éŠ€è¡Œ", accN: "569 + ID(å«è‹±æ–‡11ç¢¼)", accL: "569 + 000 + çµ±ä¸€ç·¨è™Ÿ(14ç¢¼)", mkts: ["US", "TW", "HK"] },
  { id: "F18", name: "å¾©è¯å…¨çƒè³‡ç”¢è­‰åˆ¸åŒ–åŸºé‡‘(A)", pay: 5, bank: "ä¸Šæµ·å•†æ¥­å„²è“„éŠ€è¡Œ", accN: "158 + ID(å«è‹±æ–‡11ç¢¼)", accL: "158 + 00 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼) + 0", mkts: ["US", "EU", "TW"] },
  { id: "F19", name: "å¾©è¯å…¨çƒè³‡ç”¢è­‰åˆ¸åŒ–åŸºé‡‘(B)", pay: 5, bank: "ä¸Šæµ·å•†æ¥­å„²è“„éŠ€è¡Œ", accN: "308 + ID(å«è‹±æ–‡11ç¢¼)", accL: "308 + 00 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼) + 0", mkts: ["US", "EU", "TW"] },
  { id: "F20", name: "å¾©è¯å¥§æ—åŒ¹å…‹å…¨çƒå„ªå‹¢çµ„åˆ", pay: 6, bank: "åˆä½œé‡‘åº«", accN: "99394 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "99394 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "LU", "TW"] },
  { id: "F21", name: "å¾©è¯å…¨çƒå¤§è¶¨å‹¢åŸºé‡‘", pay: 4, bank: "æ°¸è±éŠ€è¡Œ", accN: "488 + ID(å«è‹±æ–‡11ç¢¼)", accL: "488 + 000 + çµ±ä¸€ç·¨è™Ÿ(14ç¢¼)", mkts: ["US", "EU", "TW"] },
  { id: "F22", name: "å¾©è¯è¯äººä¸–ç´€åŸºé‡‘", pay: 4, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "342 + ID(å«è‹±æ–‡11ç¢¼)", accL: "342 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW", "HK"] },
  { id: "F23", name: "å¾©è¯å…¨çƒçŸ­æœŸæ”¶ç›ŠåŸºé‡‘", pay: 3, bank: "ä¸Šæµ·å•†æ¥­å„²è“„éŠ€è¡Œ", accN: "198 + ID(å«è‹±æ–‡11ç¢¼)", accL: "198 + 00 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼) + 0", mkts: ["US", "TW"] },
  { id: "F24", name: "å¾©è¯é«˜ç›Šç­–ç•¥çµ„åˆåŸºé‡‘", pay: 6, bank: "ä¸Šæµ·å•†æ¥­å„²è“„éŠ€è¡Œ", accN: "398 + ID(å«è‹±æ–‡11ç¢¼)", accL: "398 + 00 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼) + 0", mkts: ["US", "LU", "TW"] },
  { id: "F25", name: "å¾©è¯å…¨çƒåŸç‰©æ–™åŸºé‡‘", pay: 4, bank: "ç‰å±±éŠ€è¡Œ", accN: "95537 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "95537 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "EU", "TW", "CN"] },
  { id: "F26", name: "å¾©è¯æ–°èˆˆå‚µè‚¡å‹•åŠ›çµ„åˆåŸºé‡‘", pay: 6, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "271 + ID(å«è‹±æ–‡11ç¢¼)", accL: "271 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "LU", "TW"] },
  { id: "F27", name: "å¾©è¯å¤§ä¸­è¯ä¸­å°ç­–ç•¥åŸºé‡‘", pay: 4, bank: "ç‰å±±éŠ€è¡Œ", accN: "99015 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "99015 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["CN", "HK", "TW"] },
  { id: "F28", name: "å¾©è¯æ–°èˆˆå¸‚å ´çŸ­æœŸæ”¶ç›ŠåŸºé‡‘", pay: 3, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "45631 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "45631 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F29", name: "å¾©è¯æ–°èˆˆå¸‚å ´éæŠ•è³‡ç­‰ç´šå‚µ(A)", pay: 6, bank: "ç‰å±±éŠ€è¡Œ", accN: "99950 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "99950 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F30", name: "å¾©è¯æ–°èˆˆå¸‚å ´éæŠ•è³‡ç­‰ç´šå‚µ(B)", pay: 6, bank: "ç‰å±±éŠ€è¡Œ", accN: "99955 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "99955 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F31", name: "å¾©è¯æ±å”ä¸–ç´€åŸºé‡‘", pay: 4, bank: "ä¸Šæµ·å•†æ¥­å„²è“„éŠ€è¡Œ", accN: "548 + ID(å«è‹±æ–‡11ç¢¼)", accL: "548 + 00 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼) + 0", mkts: ["TW", "US", "HK"] },
  { id: "F32", name: "å¾©è¯å—éå¹£çŸ­æœŸæ”¶ç›Š(A)", pay: 6, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "40056 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "40056 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F33", name: "å¾©è¯å—éå¹£çŸ­æœŸæ”¶ç›Š(B)", pay: 6, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "40057 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "40057 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F34", name: "å¾©è¯å—éå¹£é•·æœŸæ”¶ç›Š(A)", pay: 6, bank: "æ°¸è±éŠ€è¡Œ", accN: "335 + ID(å«è‹±æ–‡11ç¢¼)", accL: "335 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F35", name: "å¾©è¯å—éå¹£é•·æœŸæ”¶ç›Š(B)", pay: 6, bank: "æ°¸è±éŠ€è¡Œ", accN: "336 + ID(å«è‹±æ–‡11ç¢¼)", accL: "336 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F36", name: "å¾©è¯å…¨çƒæ¶ˆè²»åŸºé‡‘", pay: 4, bank: "ä¸Šæµ·å•†æ¥­å„²è“„éŠ€è¡Œ", accN: "188 + ID(å«è‹±æ–‡11ç¢¼)", accL: "188 + 00 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼) + 0", mkts: ["US", "TW"] },
  { id: "F37", name: "å¾©è¯ç¾åœ‹æ–°æ˜ŸåŸºé‡‘", pay: 4, bank: "è‡ºç£ä¸­å°ä¼éŠ€", accN: "662 + ID(å«è‹±æ–‡11ç¢¼)", accL: "662 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F38", name: "å¾©è¯å…¨çƒæˆ°ç•¥é…ç½®å¼·åŸºé‡‘", pay: 6, bank: "è‡ºç£éŠ€è¡Œ", accN: "91700 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "91700 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "LU", "TW"] },
  { id: "F39", name: "å¾©è¯ä¸­åœ‹æ–°ç¶“æ¿Ÿå¹³è¡¡åŸºé‡‘", pay: 5, bank: "å…†è±éŠ€è¡Œ", accN: "33448 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "33448 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["CN", "US", "TW"] },
  { id: "F40", name: "å¾©è¯ä¸­åœ‹æ–°ç¶“æ¿ŸAè‚¡åŸºé‡‘", pay: 5, bank: "å½°åŒ–éŠ€è¡Œ", accN: "95408 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "95408 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["CN", "TW"] },
  { id: "F41", name: "å¾©è¯å…¨çƒç‰©è¯ç¶²ç§‘æŠ€åŸºé‡‘", pay: 4, bank: "åˆä½œé‡‘åº«", accN: "76142 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "76142 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW"] },
  { id: "F42", name: "å¾©è¯å°ç£æ™ºèƒ½åŸºé‡‘", pay: 5, bank: "é æ±éŠ€è¡Œ", accN: "731 + ID(å«è‹±æ–‡11ç¢¼)", accL: "731 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F43", name: "å¾©è¯äºå¤ªç¥é¾ç§‘æŠ€åŸºé‡‘", pay: 5, bank: "å°æ–°éŠ€è¡Œ", accN: "97202 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "97202 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["US", "TW", "JP", "CN"] },
  { id: "F44", name: "å¾©è¯å°ç£å¥½æ”¶ç›ŠåŸºé‡‘", pay: 3, bank: "æ°¸è±éŠ€è¡Œ", accN: "763 + ID(å«è‹±æ–‡11ç¢¼)", accL: "763 + 000 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F45", name: "å¾©è¯å°ç£ç§‘æŠ€é«˜è‚¡æ¯(A)", pay: 3, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "41926 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "41926 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] },
  { id: "F46", name: "å¾©è¯å°ç£ç§‘æŠ€é«˜è‚¡æ¯(B)", pay: 3, bank: "ç¬¬ä¸€éŠ€è¡Œ", accN: "41927 + ID(ä¸å«è‹±æ–‡9ç¢¼)", accL: "41927 + 0 + çµ±ä¸€ç·¨è™Ÿ(8ç¢¼)", mkts: ["TW"] }
];

const select = document.getElementById("fundSelect");
const searchInput = document.getElementById("fundSearch");
const tradeDateInput = document.getElementById("tradeDate");
const errorBox = document.getElementById("errorBox");
const dateNote = document.getElementById("dateNote");
const resultArea = document.getElementById("resultArea");

function hideResult() { resultArea.classList.add("hidden"); }

function updateSearchList() {
  const filter = searchInput.value.toLowerCase();
  select.innerHTML = "";
  fundData.forEach(f => {
    if (f.name.toLowerCase().includes(filter)) {
      const opt = document.createElement("option");
      opt.value = f.id;
      opt.textContent = `${f.name} (T+${f.pay})`;
      select.appendChild(opt);
    }
  });
}

function fmt(date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
}

/**
 * æ›´æ–°è¡Œäº‹æ›†ä¸Šæ–¹çš„ç¯€æ—¥æç¤º
 */
function updateHolidayNote() {
  const dval = tradeDateInput.value;
  if (!dval) {
    dateNote.classList.add("hidden");
    return;
  }
  
  const notes = [];
  const dt = new Date(dval + "T00:00:00");
  const dw = dt.getDay();
  
  if (dw === 0 || dw === 6) notes.push(`<span class="bg-slate-200 text-slate-700 holiday-badge">è·¨åœ‹é€±æœ«</span> è‚¡å¸‚èˆ‡éŠ€è¡Œä¼‘å¸‚`);

  for (const mkt in HOLIDAYS_2026) {
    if (HOLIDAYS_2026[mkt][dval]) {
      let bCol = "bg-indigo-100 text-indigo-700";
      if (mkt === 'TW') bCol = "bg-red-100 text-red-700";
      if (mkt === 'CN') bCol = "bg-orange-100 text-orange-700";
      notes.push(`<span class="${bCol} holiday-badge">${mkt}å¸‚å ´</span> ${HOLIDAYS_2026[mkt][dval]}`);
    }
  }
  
  if (notes.length > 0) {
    dateNote.innerHTML = `<p class="font-bold text-slate-700 mb-1">ğŸ“… å¸‚å ´ç¯€æ—¥æç¤ºï¼š</p>${notes.join('<br/>')}`;
    dateNote.classList.remove("hidden");
  } else {
    dateNote.classList.add("hidden");
  }
}

window.onload = () => {
  updateSearchList();
  const today = new Date();
  // é™åˆ¶èµ·å§‹æ—¥æœŸç‚º 2026
  if (today.getFullYear() < 2026) {
    tradeDateInput.value = "2026-01-01";
  } else {
    tradeDateInput.value = fmt(today);
  }
  updateHolidayNote();
};

function checkClosed(mkts, date) {
  const ds = fmt(date);
  const dw = date.getDay();
  if (dw === 0 || dw === 6) return { ok: false, msg: dw === 0 ? "é€±æ—¥ (é€±æœ«)" : "é€±å…­ (é€±æœ«)" };
  for (const m of mkts) {
    if (HOLIDAYS_2026[m] && HOLIDAYS_2026[m][ds]) {
      return { ok: false, msg: `${HOLIDAYS_2026[m][ds]} (${m}å¸‚å ´)` };
    }
  }
  return { ok: true };
}

function calculate() {
  errorBox.classList.add("hidden");
  const fid = select.value;
  const dval = tradeDateInput.value;

  if (!fid) return (errorBox.textContent = "è«‹é¸æ“‡åŸºé‡‘", errorBox.classList.remove("hidden"));
  if (!dval) return (errorBox.textContent = "è«‹è¼¸å…¥æœ‰æ•ˆæ—¥æœŸ", errorBox.classList.remove("hidden"));

  const fund = fundData.find(f => f.id === fid);
  let cur = new Date(dval + "T00:00:00");
  const timeline = [];
  let skipMsg = "";

  const logTimeline = (date, status, note, label) => {
    const ds = fmt(date);
    const existingIdx = timeline.findIndex(t => t.d === ds);
    if (existingIdx === -1) {
      timeline.push({ d: ds, status, note, label });
    } else if (status === 'main' || status === 'work') {
      timeline[existingIdx] = { d: ds, status, note, label };
    }
  };

  // 1. ç”Ÿæ•ˆäº¤æ˜“æ—¥ (T)
  let checkPos = new Date(cur);
  let tCheck = checkClosed(fund.mkts, checkPos);
  while (!tCheck.ok) {
    logTimeline(checkPos, 'skip', tCheck.msg, 'å§”è¨—é‡ä¼‘å¸‚');
    skipMsg = tCheck.msg;
    checkPos.setDate(checkPos.getDate() + 1);
    tCheck = checkClosed(fund.mkts, checkPos);
  }
  const effDate = new Date(checkPos);
  logTimeline(effDate, 'main', 'é¦–å€‹ç‡Ÿæ¥­æ—¥', 'ç”Ÿæ•ˆæ—¥ (T)');

  // 2. æ·¨å€¼æ—¥ (T+1)
  let navDate = new Date(effDate);
  navDate.setDate(navDate.getDate() + 1);
  let nCheck = checkClosed(fund.mkts, navDate);
  while (!nCheck.ok) {
    logTimeline(navDate, 'skip', nCheck.msg, 'æ·¨å€¼æ—¥é †å»¶');
    navDate.setDate(navDate.getDate() + 1);
    nCheck = checkClosed(fund.mkts, navDate);
  }
  logTimeline(navDate, 'work', 'é©ç”¨æ­¤æ—¥æ·¨å€¼', 'è²·å›æ·¨å€¼æ—¥');

  // 3. ä»˜æ¬¾æ—¥ (T+N)
  let payDate = new Date(effDate);
  let businessDays = 0;
  while (businessDays < fund.pay) {
    payDate.setDate(payDate.getDate() + 1);
    let pCheck = checkClosed(fund.mkts, payDate);
    if (pCheck.ok) {
      businessDays++;
      const isEnd = (businessDays === fund.pay);
      logTimeline(new Date(payDate), isEnd ? 'main' : 'work', isEnd ? 'åŒ¯å‡ºè²·å›åƒ¹é‡‘' : `ç¬¬ ${businessDays} å·¥ä½œæ—¥`, isEnd ? 'ä»˜æ¬¾æ—¥' : 'å·¥ä½œæ—¥');
    } else {
      logTimeline(new Date(payDate), 'skip', pCheck.msg, 'ä¼‘å¸‚é †å»¶');
    }
  }

  // æ¸²æŸ“
  resultArea.classList.remove("hidden");
  document.getElementById("resEff").textContent = fmt(effDate);
  document.getElementById("resNav").textContent = fmt(navDate);
  document.getElementById("resPay").textContent = fmt(payDate);
  document.getElementById("resLagText").textContent = `é€±æœŸï¼šT+${fund.pay} (${fund.mkts.join('/')})`;
  document.getElementById("resEffNote").textContent = skipMsg ? `âš ï¸ å›  ${skipMsg} é †å»¶` : "ç•¶æ—¥å³ç‚ºç”Ÿæ•ˆäº¤æ˜“æ—¥";
  
  document.getElementById("resBank").textContent = fund.bank;
  document.getElementById("resAccNatural").textContent = fund.accN;
  document.getElementById("resAccLegal").textContent = fund.accL;

  const list = document.getElementById("logList");
  list.innerHTML = "";
  timeline.sort((a, b) => new Date(a.d) - new Date(b.d));

  timeline.forEach(log => {
    let style = "text-slate-400";
    let badge = "bg-slate-100 text-slate-400";
    if (log.status === 'skip') badge = "bg-orange-100 text-orange-600 font-bold";
    if (log.status === 'main') {
      style = "text-indigo-950 font-black";
      badge = "bg-indigo-600 text-white font-bold";
    }
    list.innerHTML += `
      <div class="flex justify-between items-center text-[11px] py-1.5 border-b border-slate-100 last:border-0">
        <div class="flex items-center gap-2">
          <span class="timeline-date font-mono ${style}">${log.d}</span>
          <span class="text-[9px] text-slate-400 italic font-medium text-balance">(${log.note || 'ç‡Ÿæ¥­æ—¥'})</span>
        </div>
        <span class="px-2 py-0.5 rounded-full text-[8px] uppercase font-bold tracking-tighter ${badge}">${log.label}</span>
      </div>
    `;
  });
  
  resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
</script>

</body>
</html>

